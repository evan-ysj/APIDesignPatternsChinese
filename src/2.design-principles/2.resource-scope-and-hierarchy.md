# 第四章 资源规模和层级

> 本章涵盖：
> - 什么是资源布局
> - 资源关系的各种类型（引用、多对多等）
> - 实体关系图是如何描述资源布局的
> - 如何选择资源之间的正确关系
> - 需要避免的资源布局反模式

正如我们在第1章中学到的，将我们的注意力从操作转向资源使我们能够通过利用简单的模式更轻松、更快速地熟悉API。例如，REST提供了一组标准动词，我们可以将其应用于许多资源，这意味着对于我们了解的每个资源，我们还可以掌握对该资源执行的五种不同操作（create、get、list、delete和update）。

尽管这很有价值，但这意味着我们需要更加慎重的定义API资源。选择正确的资源的关键部分是了解它们将来如何相互关联。在本章中，我们将探讨如何布局API中的各种资源、可用的选项以及选择正确的方式将资源彼此关联。此外，我们将讨论在考虑如何布局API中的资源时要避免的一些反模式（anti-patterns）（不应该做的事情）。让我们从具体了解资源布局的含义开始。

## 4.1 什么是资源布局

当我们谈论资源布局时，通常指的是API中资源（或“事物”）的排列方式，定义这些资源的字段，以及这些资源如何通过这些字段相互关联。换句话说，资源布局是特定API设计的实体（资源）关系模型。例如，如果我们要构建一个聊天室的API，资源布局是指我们可能选择创建ChatRoom资源以及与ChatRoom有某种相关的User资源。我们感兴趣的是User和ChatRoom资源之间的关联方式。如果您曾经设计过具有各种表的关系数据库，这应该感觉很熟悉：您设计的数据库模式在本质上与API的表示方式非常相似。

虽然可能会说关系是唯一重要的事情，但实际上情况要复杂一些。虽然关系本身是对最终资源布局唯一有直接影响的因素，但还有许多其他因素间接影响布局。一个明显的例子是资源选择本身：如果我们选择不使用User资源，而是坚持使用按名称列出用户的简单列表（`members: string[]`），那么就没有其他资源可以布局，问题就被完全回避了。

正如名称所示，API的资源布局在视觉上可能最容易理解，即将它看作由线连接在一起的方框。例如，图4.1显示了我们可能如何考虑聊天室示例，其中有许多用户和许多聊天室彼此相互连接。

<small>图4.1 一个有很多成员的聊天室</small>
![](https://raw.githubusercontent.com/evan-ysj/APIDesignPatternsChinese/main/public/images/4.1.png)

如果我们正在构建一个在线购物API（例如，类似于亚马逊），我们可能会存储User资源以及他们的各种地址（用于运送在线购买的物品）和付款方式。此外，付款方式本身可能会引用付款方式的账单地址。这个布局如图4.2所示。

<small>图4.2 用户，付款方式和地址之间有不同的对应关系</small>
![](https://raw.githubusercontent.com/evan-ysj/APIDesignPatternsChinese/main/public/images/4.2.png)

简而言之，要记住资源布局是一个广泛的概念，涵盖了所有我们为API定义的资源。最重要的是这些资源如何相互交互和关联。在下一节中，我们将简要介绍不同类型的关系以及每种类型可能提供的交互（和限制）。

### 4.1.1 资源关系的类型

### 4.1.2 实体关系图

## 4.2 选择正确的资源关系

### 4.2.1 你是否真的需要某种资源关系？

### 4.2.2 引用数据还是內联数据

### 4.2.3 层级

## 4.3 反模式

### 4.3.1 万物皆资源

### 4.3.2 深层结构

### 4.3.3 內联一切

## 4.4 练习

## 本章总结