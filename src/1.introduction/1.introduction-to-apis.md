# 什么是API

> 本章涵盖：
> - 什么是接口
> - 什么是API
> - 什么是资源导向
> - 什么是“好”的API

很可能，拿起这本书的人已经对API的上层概念有所了解。此外，你可能已经知道API代表应用程序编程接口，因此本章的重点将更详细地解释这些基础知识，以及它们为什么重要。让我们更仔细地看看API的这个概念。

## 什么是web API

API（应用程序编程接口）定义了计算机系统相互交互的方式。鉴于不可能有系统存在于真空中，API无处不在也就不足为奇了。我们可以在我们使用的语言包管理器中找到API（例如，提供类似`function encrypt(input: string): string`的加密库）。在我们自己编写的代码中也可以找到API，即使他们不是为他人使用而产生。但有一种特殊类型的API是专为通过网络公开并远程为他人使用的，这正是本书的重点，通常被称为“Web API”。

Web API在许多方面都很有趣，但这个特殊类别最有趣的方面可能是建立API的人有很大的控制权，而使用Web API的人相对较少。当我们使用库时，我们处理库本身的本地副本，这意味着构建API的人可以随心所欲地做任何他们想做的事情，而不会伤害用户。Web API则不同，因为没有副本。相反，当Web API的构建者进行更改时，这些更改会被强制应用于用户，无论更改是否源自用户要求。

例如，想象一下一个允许你加密数据的Web API调用。如果负责这个API的团队决定在加密数据时使用不同的算法，你实际上没有选择的余地。在调用加密方法时，你的数据将使用最新的算法进行加密。在一个更极端的例子中，团队可以决定完全关闭API并忽略你的请求。那时，你的应用程序将突然停止工作，你无法做太多事情。图1.1展示了这两种情况。

![](https://raw.githubusercontent.com/evan-ysj/APIDesignPatternsChinese/main/public/images/1.1.png)

然而，对于API的使用者来说，Web API的缺点通常是那些构建API的人的主要优势：他们能够完全掌控API。例如，如果加密API使用了一个绝密的新算法，构建它的团队可能不希望将那段代码以库的形式随意分享给全世界。相反，他们可能更喜欢使用Web API，这将允许他们展示超级秘密算法的功能，而不会泄露他们宝贵的知识产权。还有一些情况，某个系统可能需要非凡的计算能力，如果部署为库并在家用计算机或笔记本电脑上运行，那么运行时间将太长。在这些情况下，例如在许多机器学习API中，构建Web API允许你展示强大的功能，同时将计算需求对使用者隐藏起来，如图1.2所示。

![](https://raw.githubusercontent.com/evan-ysj/APIDesignPatternsChinese/main/public/images/1.2.png)

既然我们了解了API（特别是Web API）是什么，这就引发了一个问题：它们为什么如此重要呢？

## 为什么API很重要

虽然将软件设计和构建仅供人类使用并不罕见，这本身并没有根本性问题。然而，过去几年，我们越来越多地关注自动化，我们的目标是构建能够以更快的速度执行人类工作的计算机程序。不幸的是，正是在这一点上，“仅供人类使用”的软件成为了一个问题。

当我们专门为人类使用设计某物，其中我们的互动涉及鼠标和键盘时，我们倾向于将系统的布局和视觉方面与原始数据和功能方面混为一谈。这是有问题的，因为很难向计算机解释如何与图形界面进行交互。而且这个问题变得更加严重，因为改变程序的视觉方面也可能要求我们重新教导计算机如何与这个新的图形界面进行交互。实际上，虽然对我们来说这些变化可能只是表面上的，但对计算机来说却是完全无法识别的。换句话说，对于计算机来说，不存在“仅仅是表面上的”这种东西。

API是专门为计算机设计的接口，具有使计算机能够轻松使用它们的重要特性。例如，这些接口没有视觉方面的内容，因此无需担心表面上的变化。而且这些接口通常以“兼容”（compatible）的方式演进（参见第24章），因此在面对新的变化时不需要重新教导计算机任何内容。简而言之，API提供了一种以安全和稳定的方式与计算机进行交互所需的语言。

但这并不仅限于简单的自动化。API还打开了组合（composite）的大门，使我们能够像乐高积木一样处理功能，将各个部分组合在一起，以新颖的方式构建远大于其各部分之和的东西。为了完成这个循环，这些新的API组合也可以加入可重复使用的构建块的行列，从而实现更复杂和非凡的未来项目。

但这引出了一个重要问题：我们如何确保我们构建的API像乐高积木一样相互契合？让我们首先看看其中一种策略，即资源导向（resource orientation）。

## 什么是资源导向API

许多现今存在的Web API有点像仆人：你要求它们做某事，它们就会去做。例如，如果我们想要获取我们家乡的天气，我们可以像对待仆人一样命令Web API来`predictWeather(postalCode=10011)`。通过调用预配置的子程序或方法来命令另一台计算机执行某项任务的这种方式通常被称为进行“远程过程调用”（RPC），因为我们实际上是在调用一个库函数（或过程），以在潜在遥远的另一台计算机上执行（或远程执行）。像这样的API主要关注正在执行的操作。也就是说，我们考虑计算天气（`predictWeather(postalCode=...)`）或加密数据（`encrypt(data=...)`）或发送电子邮件（`sendEmail(to=...)`）等，每个都强调“正在做”某事。

那么为什么不是所有API都是RPC导向的呢？其中一个主要原因与“有状态性”（statefulness）的概念有关，因为API调用可以是“有状态的”或“无状态的”。当API调用可以独立于所有其他API请求而进行，而且没有任何额外的上下文或数据时，被认为是无状态的。例如，用于预测天气的Web API调用只涉及一个独立的输入（邮政编码），因此被视为无状态。另一方面，一个Web API可以存储用户喜欢的城市并提供这些城市的天气预报，这个API在运行时不需要输入，但需要用户已经存储了他们感兴趣的城市。因此，这种涉及其他先前请求或先前存储的数据的API请求被视为有状态。事实证明，RPC风格的API非常适用于无状态功能，但当我们引入有状态的API方法时，它们往往不太合适。

> 注意：如果你熟悉REST，现在可能是一个好时机指出，这一节不是关于REST和RESTful API特定的，而更普遍地涉及强调“资源”的API（正如大多数RESTful API所做的）。换句话说，虽然与REST的主题有很多重叠，但这一节比仅仅是REST要更通用一些。

为了理解这一点，让我们来看一个用于预订航班的有状态API的示例。在表1.1中，我们可以看到一系列用于与航空旅行计划进行交互的RPC，涵盖了安排新预订、查看现有预订和取消不需要的旅行等操作。

<small>表1.1 示例航班预订API方法摘要</small>
| 方法 | 描述 |
| --- | --- |
| ScheduleFlight() | 预定新航班 |
| GetFlightDetails() | 展示特定航班详细信息 |
| ShowAllBookings() | 展示当前所有预定信息 |
| CancelReservation() | 取消预定 |
| RescheduleFlight() | 更改已预定航班 |
| UpgradeTrip() | 升级舱位 |


## 什么是“好”的API



## 本章总结
